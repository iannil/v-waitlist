# 架构设计 | Architecture

## 设计哲学

1. **极简部署** - 一键部署到 Vercel/Cloudflare
2. **极低成本** - 利用 Serverless 和 Free Tier，开发者前期零成本
3. **极致性能** - 排行榜读写频率极高，需要毫秒级响应
4. **嵌入即用** - 前端集成不超过 3 行代码

## 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户网站 / Landing Page                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  <v-waitlist project-id="xyz" mode="modal"></v-waitlist>  │  │
│  └────────────────────────────────────────────────────────────┘  │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Vercel Edge Functions                        │
│  ┌─────────────────────┐  ┌─────────────────────┐              │
│  │   POST /api/join    │  │  GET /api/status    │              │
│  └──────────┬──────────┘  └──────────┬──────────┘              │
│             │                        │                          │
│  ┌──────────┴────────────────────────┴──────────┐              │
│  │           GET /api/export (Admin)             │              │
│  └──────────────────────────────────────────────┘              │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Upstash Redis (HTTP API)                   │
│  ┌──────────────────┐  ┌──────────────────┐  ┌───────────────┐ │
│  │  ZSET 排行榜     │  │  HASH 用户资料   │  │ STRING 邀请码 │ │
│  │  Leaderboard     │  │  User Profile    │  │ Referral Map  │ │
│  └──────────────────┘  └──────────────────┘  └───────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                               ▲
                               │
                         ┌─────┴─────┐
                         │  Security │
                         └───────────┘
  ┌──────────────────┐  ┌──────────────────┐
  │ Cloudflare       │  │  Upstash         │
  │ Turnstile (CAP)  │  │  RateLimit       │
  └──────────────────┘  └──────────────────┘
```

## 技术选型

| 层级 | 技术选择 | 理由 |
|------|----------|------|
| 计算层 | Next.js Edge Runtime | 冷启动快，抗并发，部署简单 |
| 存储层 | Upstash Redis | 原生 HTTP API，Free Tier 足够，适合排行榜 |
| 前端 SDK | Preact + Vite | 超轻量，打包后单文件 |
| 安全层 | Cloudflare Turnstile | 免费无感验证码 |
| UI 组件 | Web Components | 原生支持，Shadow DOM 隔离样式 |

## Monorepo 结构

```
v-waitlist/
├── apps/
│   ├── web/          # 演示落地页 / 官网
│   └── api/          # Next.js 后端 API
├── packages/
│   └── sdk/          # 前端 SDK 源码
├── docs/             # 项目文档
├── .github/          # GitHub 配置
├── package.json      # 根依赖管理
├── turbo.json        # Turborepo 配置
└── vercel.json       # Vercel 部署配置
```

## 为什么这个方案能赢

### 零成本 (True Zero Cost)
- Vercel Hobby Plan: 免费
- Upstash Free Tier: 每天 10k 请求免费
- 总成本: $0

### 数据掌控 (Data Ownership)
- 数据存储在用户自己的 Redis 实例
- 随时导出 CSV
- 不依赖第三方平台

### 极速 (Speed)
- Redis 内存操作
- Edge Function 全球分发
- 响应时间 < 100ms

### 简单 (Simplicity)
```html
<!-- 只需 3 行代码 -->
<script src="https://cdn.v-waitlist.com/sdk.js"></script>
<v-waitlist project-id="xyz"></v-waitlist>
```

## 竞品对比

| | V-Waitlist | Viral Loops |
|---|---|---|
| 价格 | $0 | $99/月起 |
| 性能 | <100ms | 较慢 |
| 数据所有权 | 用户自己 | 第三方平台 |
| 集成难度 | 3 行代码 | 复杂集成 |
